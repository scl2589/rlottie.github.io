<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="rlottie viewer">
    <meta name="keywords" content="lottie, rlottie, lottie viewer, rlottie viewer">
    <meta name="author" content="Subhransu">
    <title>rlottie viewer</title>
    <link rel="stylesheet" href="style.css">
    <!-- bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    
    <!-- vuetify -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"/>
    <style>
      .player {
          height: 92vh;
          padding: 0;
          background-color: none;
        }

        .screen {
          height: 68vh;
          background-color: none
        }

        #myCanvas {
          border: 1px solid #000000
        }

        /* .toolbox {
          background-color:#1D3557;
          color: #fdfdfd
        } */

        .toolbox-basic {
          height: 10vh;
          width: 100%;
        }

        .play-button {
          background-color: none;
        }

        .player-slider {
          min-width: 30vw;
        }

        .extra-tools {
          height: 12vh;
        }

        .screen-canvas {
          /* max-width: 50vw;
          max-height: 50vh; */
        }

        .scroll-sect {
          overflow-y: scroll; 
          height: 10vh;
        }

        

    </style>
  </head>

  <body>
    <v-app class="window" id="app">
      <div class="row no-gutters">
        <navbar @canvas-changed="changeCanvas" @file-changed="changeFile" class="col-12"></navbar>

        <leftpanel @layer-selected="layerSelected" :layers="layers" :key="componentKey" class="col-3"></leftpanel>
        
        <!-- Player  -->
        <div class="col-6 bg-white">
          <div class="player d-flex flex-column justify-content-between">
            <!-- <p>{{ canvasStyling[canvasShape] }}</p> -->
            <div class="screen my-auto d-flex flex-column justify-content-center align-items-center" id="content">
              <canvas
                v-show="isContent" 
                id="myCanvas" 
                :style="canvasStyling" 
              ></canvas>
              <div v-show="!isContent">
                <h5> Drag and Drop your Lottie JSON file to the window</h5>
              </div>
            </div>
        
            <div class="toolbox">
              <div class="collapse" id="collapseExtraTools">
                <div class="extra-tools d-flex justify-content-around align-items-center">
                  <div class="d-flex flex-column justify-content-center align-items-center mx-3">
                    <v-row class="align-items-center">
                      <v-col cols="12">
                        <v-select
                          color="grey lighten-5"
                          v-model="defaultSpeed"
                          :items="speed"
                          :menu-props="{ top: true, offsetY: true }"
                          label="Play Speed"
                          @change="changePlay"
                        ></v-select>
                      </v-col>
                    </v-row>
                  </div>
                  <div class="d-flex flex-column justify-content-center align-items-center mx-3">
                    <v-row class="align-items-center">
                      <v-col cols="12">
                        <v-select
                          color="grey lighten-5"
                          v-model="defaultType"
                          :items="types"
                          :menu-props="{ top: true, offsetY: true }"
                          label="Play Type"
                          @change="changePlayType"
                        ></v-select>
                      </v-col>
                    </v-row>
                  </div>
                  <div class="d-flex flex-column justify-content-center align-items-center mx-3">
                    <v-row class="align-items-center">
                      <v-col cols="12">
                        <v-select
                          color="grey lighten-5"
                          v-model="defaultDirection"
                          :items="directions"
                          :menu-props="{ top: true, offsetY: true }"
                          label="Play Direction"
                          @change="changePlay"
                        ></v-select>
                      </v-col>
                    </v-row>
                  </div>
                </div>
              </div>
              <div class="d-flex justify-content-around align-items-center toolbox-basic">
                <span class="play-button" type="button" id="playButton" onclick="buttonClicked()"><i class="fas fa-pause"></i></span>
                <div class="d-flex flex-column align-items-between">
                  <input class="player-slider mb-1" type="range" id="slider" min="0" max="100" value="0" oninput="onSliderDrag(this.value)">
                  <div class="d-flex justify-content-between">
                    <span class="badge badge-light" id="currentFrame"></span>
                    <span class="badge badge-light" id="frameCount"></span>
                  </div>
                </div>
                <span class="" data-toggle="collapse" href="#collapseExtraTools" role="button" aria-expanded="false" aria-controls="collapseExtraTools">
                  <i class="fas fa-bars"></i>
                </span>
              </div>
            </div>
          
          </div>
        </div>
        
        <property v-if="isLayer" :selected-layer="selectedLayer" class="col-3"></property>

        <preference v-else @bg-color-changed="changeBackgroundColor" class="col-3"></preference>

      </div>
    </v-app>

    <script src="main.js"></script>
    <!-- vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.0"></script>
    <!-- dependencies for bootstrap -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!-- http-vue-loader -->
    <script src="https://unpkg.com/http-vue-loader"></script> 
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script>
      var app = new Vue({
        el: '#app',
        vuetify: new Vuetify({
          theme: {
            themes: {
              dark: {
                navbar: '#263238',
                toolbox: '#263238',
                sidebar: '#37474F',
                accent: '#098e8f',
                preview: '#0b6687',
                icon: '#FFFFFF',
                mode: '#ECEFF1',
              },
              light: {
                navbar: '#CFD8DC',
                toolbox: '#CFD8DC',
                sidebar: '#ECEFF1',
                accent: '#A8DADC',
                preview: '#56a6c2',
                icon: '#000000',
                mode: '#37474F',
              }
            },
          },
        }),

        components: {
          'navbar': httpVueLoader('./components/navbar.vue'),
          'leftpanel': httpVueLoader('./components/leftPanel.vue'),
          'player': httpVueLoader('./components/player.vue'),
          'property': httpVueLoader('./components/property.vue'),
          'preference': httpVueLoader('./components/preference.vue')
        },

        data() {
          return {
            selection: '',
            layers: null,
            isLayer: false,
            selectedLayer: null,
            backgroundColor: null,
            canvasShape: 0,
            componentKey: 0,
            
            // player settings
            content: true,
            defaultSpeed: '1.0',
            defaultType: 'Autoplay',
            defaultDirection: 'Forward',
            speed: ['0.25', '0.5', '0.75', '1.0', '1.25', '1.5', '1.75', '2.0'],
            types: ['Autoplay', 'Hover', 'Bounce'],
            directions: ['Forward', 'Backward'],
            hoverFlag: false,
          }
        },
        computed: {
          isContent() {
            if (true) {
              return true
            } else {
              return false
            }
          },
          canvasStyling() {
            if (this.canvasShape == 0) {
              return {
                'background-color': this.backgroundColor,
                'border-radius': 0,
                'width': '483px',
                'height': '483px'
              }
            } else {
              return {
                'background-color': this.backgroundColor,
                'border-radius': '50%',
                'width': '483px',
                'height': '483px'
              }
            }
          }
        },
        methods: {
          layerSelected(layer) {
            this.isLayer = !!layer
            if (layer) {
              this.selectedLayer = layer
            }
          },

          changeBackgroundColor(color) {
            this.backgroundColor = color
          },

          changeCanvas(toggle_one) {
            this.canvasShape = toggle_one
          },
          changeFile() {
            this.layers = null;
            setTimeout(() => {
              this.layers = getLayerList();
            }, 500);
          },

          changePlay() {
            if (this.defaultDirection === 'Forward') {
              setPlaySpeed(Number(this.defaultSpeed))
            }
            else {
              setPlaySpeed(Number(this.defaultSpeed) * -1)
            }
          },
          changePlayType() {
            if(this.defaultType === "Hover") {
              RLottieModule.pause();
              document.getElementById("content").addEventListener("mouseover", RLottieModule.play);
              document.getElementById("content").addEventListener("mouseout", RLottieModule.pause);
              this.hoverFlag = true;
            }
            if(this.defaultType !== "Hover" && this.hoverFlag) {
              RLottieModule.play();
              document.getElementById("content").removeEventListener("mouseover", RLottieModule.play);
              document.getElementById("content").removeEventListener("mouseout", RLottieModule.pause);
              this.hoverFlag = false;
            }
            if(this.defaultType === "Bounce") {
              RLottieModule.isBounce = true;
            }
            if(this.defaultType !== "Bounce") {
              RLottieModule.isBounce = false;
            }
          },
        },
        created() {
          this.$vuetify.theme.dark = true
        },
      });
    </script>
  </body>

</html>